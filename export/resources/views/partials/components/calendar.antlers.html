{{ if config:app:debug is true }}<!-- ðŸ‘‹ resources/views/partials/components/calendar.antlers.html -->{{ /if }}


<section class="{{ section_width ?? 'w-full' }} {{ style:color_themes[color_theme] ?? '' }} py-4 lg:py-4">
  <div class="pagewidth">

  {{ if title or text }}
  <article class="mb-4 lg:mb-8">
    {{ if show_more_link }}
    <a href="{{ show_more_link }}">
    {{ /if }}
    {{ if title }} <h2 class="font-display text-4xl lg:text-7xl text-center"> {{ title }}</h2>{{ /if}}
    {{ if show_more_link }}
    </a>
    {{ /if }}

    {{ if text }}<div class="mt-4 max-w-prose mx-auto text-amber-100 mb-4 lg:text-xl border-l-4 border-amber-800 pl-4 text-center"> {{ text }}</div>{{ /if}}
  </article>
  {{ /if }}

  <div class="
    {{# Mobile layout classes #}}
    {{ if (layout_type_mobile ?? 'grid') == 'scroll' }}flex gap-2 flex-nowrap overflow-y-scroll snap-x relative pb-4{{ else }}grid {{ columns_mobile ?? 'grid-cols-1' }} gap-2{{ /if }}
    {{# Desktop layout classes #}}
    {{ if (layout_type_desktop ?? 'grid') == 'scroll' }}lg:flex lg:gap-2 lg:flex-nowrap lg:overflow-y-scroll lg:snap-x lg:relative lg:px-4{{ else }}lg:grid {{ columns ?? 'lg:grid-cols-4' }} lg:gap-4{{ /if }}
    ">

    {{# Logic setup #}}
    {{ $now = now | format('Y-m-d H:i') }}
    {{ $query_start = start_date ? (start_date | format('Y-m-d H:i')) : (hide_past_events ? $now : '1900-01-01 00:00') }}
    {{ $query_end   = end_date   ? (end_date   | format('Y-m-d 23:59')) : '2100-01-01 23:59' }}

    {{ collection:events
      sort="event_start:asc"
      :taxonomy:tags="selected_tags ? (selected_tags | pluck:slug | join('|')) : null"
      :taxonomy:calendar="selected_calendar ? (selected_calendar | pluck:slug | join('|')) : null"
      paginate="{ number_of_entries ?: 9999 }"
      as="entries"
    }}
    {{ entries }}
      {{# Determine when the event effectively starts and ends #}}
      {{ $e_start = event_start | format('Y-m-d H:i') }}
      {{ $e_end   = (event_end ?? event_start) | format('Y-m-d 23:59') }}

      {{# Overlap Logic #}}
      {{ if ($e_start <= $query_end) && ($e_end >= $query_start) }}
        {{ partial src="{ card_partial ?? 'cards/card-event'}" 
           card_width_mobile="{card_width_mobile}" 
           card_width_desktop="{card_width_desktop ?? 'lg:w-full'}" 
        }}
      {{ /if }}
    {{ /entries }}

    {{ if no_results }}
      <div class="col-span-full text-center py-16 bg-gray-50 rounded-2xl border-2 border-dashed border-gray-200">
        <p class="text-gray-500 text-xl font-medium">No events found.</p>
      </div>
    {{ /if }}

    {{# Pagination #}}
    {{ if paginate.total_pages > 1 }}
      <div class="col-span-full justify-center items-center gap-4 mt-4
        {{# Hide on mobile if disabled #}}
        {{ if show_pagination_mobile }}flex{{ else }}hidden{{ /if }}
        {{# Hide on desktop if disabled, or show if enabled #}}
        {{ if show_pagination_desktop }}lg:flex{{ else }}lg:hidden{{ /if }}">

        {{ paginate }}
          <a href="{{ prev_page }}" class="p-2 {{ if !prev_page }}pointer-events-none opacity-50{{ /if }}">{{ svg src="arrow-left" class="size-4 " }} </a>
          <div class="text-sm">
            {{ current_page }} : {{ total_pages }}
          </div>
          <a href="{{ next_page }}" class="p-2 {{ if !next_page }}pointer-events-none opacity-50{{ /if }}">{{ svg src="arrow-right" class="size-4 " }}</a>
        {{ /paginate }}
      </div>
    {{ /if }}

    {{ /collection:events }}
  </div>

  {{# Show More Link #}}
  {{ if show_more_link }}
  <div class="mt-4 lg:mt-8 text-center">
    <a href="{{ show_more_link }}" class="inline-flex gap-4 items-center">
    <span>{{ show_more_link_text ?? 'Show More' }}</span>
    {{ svg src="arrow-right" class="size-4 fill-pink-900" }}
    </a>
  </div>
  {{ /if }}

  </div>
</section>