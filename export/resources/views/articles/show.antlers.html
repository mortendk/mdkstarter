{{ if config:app:debug is true }}<!-- ðŸ‘‹ resources/views/articles/show.antlers.html -->{{ /if }}

<article class="pagewidth text-amber-950 mt-8" 
         x-data="{ 
            tocHtml: '',
            init() {
                this.$nextTick(() => {
                    const originalToc = this.$refs.content.querySelector('.table-of-contents');
                    if (originalToc) {
                        // 1. Clone the TOC
                        const clone = originalToc.cloneNode(true);
                        
                        // 2. Strip inner HTML tags from all links (like <code>)
                        clone.querySelectorAll('a').forEach(link => {
                            link.textContent = link.textContent; // This strips tags
                        });

                        // 3. Set the clean HTML to our sidebar
                        this.tocHtml = clone.outerHTML;
                    }
                });
            }
         }">

  <h1 class="text-7xl lg:text-8xl font-display text-balance break-all pb-12">{{ title }}</h1>

  {{ if markdown_small }}
  <div class="font-manchet text-3xl lg:text-5xl mx-auto mb-4 text-amber-800 font-serif max-w-3xl">
  {{ markdown_small }}
  </div>
  {{ /if}}

  {{ if primary_image }}
  <div class="pb-4 drop-shadow-lg">
  <img src="{{ glide :src="primary_image" w="1200" fit="crop_focal" }}" alt="{{ primary_image:alt }}" class="w-full h-full object-cover" loading="eager" />
  </div>
  {{ /if }}

  <div class="flex flex-col lg:flex-row gap-12 mt-12">
    
    {{# Sidebar for TOC (displayed only if tocHtml is not empty) #}}
    <template x-if="tocHtml">
      <aside class="lg:w-1/4 shrink-0 order-2 lg:order-1">
        <nav class="sticky top-24 p-6 bg-amber-50 rounded-2xl border border-amber-100">
          <h2 class="text-xs font-bold uppercase tracking-widest text-amber-900/50 mb-4">Table of Contents</h2>
          <div class="prose prose-sm prose-amber toc-sidebar" x-html="tocHtml">
          </div>
        </nav>
      </aside>
    </template>

    <div class="flex-grow order-1 lg:order-2">
      <div class="wysiwyg max-w-none" x-ref="content">
        {{# The TOC is rendered inside here but hidden by CSS #}}
        {{ markdown_advanced }}
      </div>
    </div>
  </div>

  {{ blocks }}
  {{ partial src="components/{type}" }}
  {{ /blocks }}

  <footer class="mt-12 pt-8 border-t border-amber-100">
  {{ if tags }}
  <div class="flex flex-wrap gap-2 mb-4">
    {{ tags }}
    {{ partial:taxonomy/tag }}
    {{ /tags }}
  </div>
  {{ /if }}

  {{ if category }}
  <div class="max-w-prose flex flex-wrap gap-2">
    {{ category }}
    {{ partial:taxonomy/category }}
    {{ /category }}
  </div>
  {{ /if }}
  </footer>

  <aside class="flex flex-row gap-2 max-w-prose bg-amber-400 mt-8 p-4 rounded-lg">
  <time datetime="{{ date format='Y-m-d' }}">
    {{ date iso_format="D MMMM YYYY" }}
    {{ date format="H:i" }}
  </time>

  {{ if author }}
  af
  {{ author }}
  <div class="font-bold">{{ name }}</div>
  {{ /author }}
  {{ /if }}
  </aside>

</article>

{{ collection:articles
  limit="3"
  id:isnt="{id}"
  sort="date:desc"
  :taxonomy:tags="tags ? (tags | pluck:slug | join('|')) : null"
  :taxonomy:category="(!tags && category) ? category:slug : null"
  as="related_articles"
}}
{{ if related_articles }}
<section class="pagewidth border-t pt-12 mt-12">
  <h2 class="text-3xl font-bold mb-8">Related Articles</h2>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
  {{ related_articles }}
  {{ partial:cards/card }}
  {{ /related_articles }}
  </div>
</section>
{{ /if }}
{{ /collection:articles }}